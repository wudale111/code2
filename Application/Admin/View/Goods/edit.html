<!DOCTYPE html>
<html><head>
        <meta charset="utf-8">
    <title>童老师ThinkPHP交流群：484519446</title>

    <meta name="description" content="Dashboard">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!--Basic Styles-->
    <link href="__PUBLIC__/style/bootstrap.css" rel="stylesheet">
    <link href="__PUBLIC__/style/font-awesome.css" rel="stylesheet">
    <link href="__PUBLIC__/style/weather-icons.css" rel="stylesheet">

    <!--Beyond styles-->
    <link id="beyond-link" href="__PUBLIC__/style/beyond.css" rel="stylesheet" type="text/css">
    <link href="__PUBLIC__/style/demo.css" rel="stylesheet">
    <link href="__PUBLIC__/style/typicons.css" rel="stylesheet">
    <link href="__PUBLIC__/style/animate.css" rel="stylesheet">
    <!-- 引入ueditor -->
    <script src="__PUBLIC__/ueditor/ueditor.config.js"></script>
    <script src="__PUBLIC__/ueditor/ueditor.all.min.js"></script>
    <script src="__PUBLIC__/ueditor/lang/zh-cn/zh-cn.js
"></script>
</head>
<body>
    <!-- 头部 -->
    <include file="Common/header" />

    <!-- /头部 -->
    
    <div class="main-container container-fluid">
        <div class="page-container">
                        <!-- Page Sidebar -->
            <include file="Common/left" />
            <!-- /Page Sidebar -->
            <!-- Page Content -->
            <div class="page-content">
                <!-- Page Breadcrumb -->
                <div class="page-breadcrumbs">
                    <ul class="breadcrumb">
                                        <li>
                        <a href="__MODULE__/Index/index">系统</a>
                    </li>
                                        <li>
                        <a href="__CONTROLLER__/lst">商品列表</a>
                    </li>
                                        <li class="active">修改商品</li>
                                        </ul>
                </div>
                <!-- /Page Breadcrumb -->

                <!-- Page Body -->
                <div class="page-body">
                    
<div class="row">
    <div class="col-lg-12 col-sm-12 col-xs-12">
        <div class="widget">
            <div class="widget-header bordered-bottom bordered-blue">
                <span class="widget-caption">修改商品</span>
            </div>
            <div class="widget-body">
                <div id="horizontal-form">
                    <form class="form-horizontal" role="form" action="" method="post" enctype="multipart/form-data" >
                        <input type="hidden" name="id" value="{$goods.id}">
                        <!-- 111111111111111111111111111111111 -->
                        <div class="tabbable">
                            <ul id="myTab11" class="nav nav-tabs tabs-flat">
                                <li class="active">
                                    <a href="#home11" data-toggle="tab">
                                        基本信息
                                    </a>
                                </li>
                                <li class="">
                                    <a href="#profile11" data-toggle="tab">
                                        商品描述
                                    </a>
                                </li>
                                <li class="">
                                    <a href="#profile12" data-toggle="tab">
                                        会员价格
                                    </a>
                                </li>
                                <li class="">
                                    <a href="#profile13" data-toggle="tab">
                                        商品属性
                                    </a>
                                </li>
                                <li class="">
                                    <a href="#profile14" data-toggle="tab">
                                        商品图片
                                    </a>
                                </li>
                            </ul>
                            <div class="tab-content tabs-flat">
                                <div class="tab-pane active" id="home11">

                                   <div class="form-group">
                                        <label class="col-sm-2 control-label no-padding-right" for="username">商品名称</label>
                                        <div class="col-sm-6">
                                            <input type="text" name="goods_name" value="{$goods.goods_name}" placeholder="" class="form-control">
                                        </div>
                                        <p class="help-block col-sm-4 red">* 必填</p>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label no-padding-right" for="username">商品缩略图</label>
                                        <div class="col-sm-6">
                                            <input type="file"  name="original" style="display:inline;">
                                            <if condition="$goods['original'] eq ''">暂无缩略图
                                            <else />
                                            <img src="__ROOT__{$goods.sm_thumb}" height="24">
                                            </if>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label no-padding-right" for="username">所属分类</label>
                                        <div class="col-sm-6">
                                            <select name="cate_id">
                                                <option value="">请选择</option>
                                                <volist name="cateres" id="vo">
                                                    <option <if condition="$vo['id'] eq $goods['cate_id']">selected</if> value="{$vo.id}"><if condition="$vo['pid'] neq 0">|</if><?php echo str_repeat('-', $vo['level']*8);?>{$vo.catename}</option>
                                                </volist>
                                            </select>
                                        </div>
                                        <p class="help-block col-sm-4 red">* 必填</p>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label no-padding-right" for="username">所属品牌</label>
                                        <div class="col-sm-6">
                                            <select name="brand_id">
                                            <option>请选择</option>
                                            <volist name="brandres" id="vo">
                                                <option <if condition="$vo['id'] eq $goods['brand_id']">selected</if> value="{$vo.id}">{$vo.brand_name}</option>
                                            </volist>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label no-padding-right" for="username">市场价格</label>
                                        <div class="col-sm-6">
                                            <input type="text" required="" name="market_price" value="{$goods.market_price} " placeholder=""  class="form-control" >
                                        </div>
                                        <p class="help-block col-sm-4 red">* 必填</p>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label no-padding-right" for="username">本店价格</label>
                                        <div class="col-sm-6">
                                            <input type="text" required="" name="shop_price" value="{$goods.shop_price}" placeholder="" class="form-control" >
                                        </div>
                                        <p class="help-block col-sm-4 red">* 必填</p>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label no-padding-right" for="username">商品重量</label>
                                        <div class="col-sm-6">
                                            <input type="text" required="" name="goods_weight" value="{$goods.goods_weight}" placeholder="" style="width:80%; float:left; margin-right:10px;" class="form-control" >
                                            <select name="weight_unit">
                                                <option <if condition="$goods['weight_unit'] eq 'g'">selected="selected"</if> value="g">克</option>
                                                <option <if condition="$goods['weight_unit'] eq 'kg'">selected="selected</if> value="kg">千克</option>
                                            </select>
                                        </div>
                                        <p class="help-block col-sm-4 red">* 必填</p>
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label no-padding-right" for="username">是否上架</label>
                                       <div class="col-sm-6">
                                           <div class="checkbox">
                                                <label>
                                                    <input type="checkbox" name="onsale" <if condition="$goods['onsale'] eq 1"> checked="checked"</if> class="colored-success" />
                                                    <span class="text">上架</span>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label class="col-sm-2 control-label no-padding-right" for="username">商品推荐</label>
                                       <div class="col-sm-6">
                                           <div class="checkbox">
                                                <volist name="recposres" id="recpos">
                                                    <label style="margin-right:15px;">
                                                        <input 
                                                        <?php if(in_array($recpos['id'],$recids)){echo'checked="checked"';}?>

                                                        type="checkbox" name="recid[]" value="{$recpos.id}"  class="colored-success">
                                                        <span class="text">{$recpos.recname}</span>
                                                    </label>
                                                </volist>

                                            </div>
                                        </div>
                                    </div>

                                </div>

                                <div class="tab-pane" id="profile11">
                                    <textarea id="goods_desc" name="goods_desc">{$goods.goods_desc}</textarea>
                                </div>

                                <div class="tab-pane" id="profile12">
                                    <volist name="levres" id="vo">
                                        <div class="form-group">
                                            <label class="col-sm-2 control-label no-padding-right" for="username">{$vo.level_name}</label>
                                            <div class="col-sm-6">
                                                <input type="text"
                                                    <foreach name="mpres" item="vo1" >
                                                        <if condition="$vo1['level_id'] eq $vo['id']"> value="{$vo1.price}" </if>
                                                    </foreach>
                                                 name="mp[{$vo.id}]" class="form-control">
                                            </div>
                                        </div>
                                    </volist>
                                </div>

                                <div class="tab-pane" id="profile13">
                                    <div class="form-group">
                                            <label class="col-sm-2 control-label no-padding-right" for="username">选择商品类型</label>
                                            <div class="col-sm-6">
                                               <select <if condition="$goods['type_id'] neq 0"> disabled="disabled"</if> name="type_id">
                                                   <option>选择商品类型</option>
                                                   <volist name="typeres" id="vo">
                                                        <option <if condition="$goods['type_id'] eq $vo['id']">selected="selected"</if> value="{$vo.id}">{$vo.type_name}</option>
                                                   </volist>
                                               </select>
                                            </div>
                                    </div>
                                    <div id="attr">
                                        <?php if($attrres): 
                                              foreach ($attrres as $k=>$v):
                                        ?>
                                        <?php if($v['attr_type'] == '1'): 
                                              $_attr=explode(',', $v['attr_values']);
                                              foreach ($gattrres[$v['id']] as $k2 => $v2):
                                        ?>
                                            <div class='form-group' gaid=<?php echo $v2['id'];?>><label class='col-sm-2 control-label no-padding-right'><a href='javascript:;' onclick='attrad(this);'><?php if($k2==0){echo '[+]';}else{echo '[-]';}?></a><?php echo $v['attr_name'];?></label>
                                            <div class='col-sm-6'>
                                                <select name="old_goods_attr[<?php echo $v['id'];?>][]">
                                                    <option value="">请选择</option>
                                                    <?php foreach ($_attr as $k1 => $v1):
                                                          if($v2['attr_value'] == $v1){
                                                            $selected='selected="selected"';
                                                          }else{
                                                            $selected='';
                                                          }
                                                     ?>
                                                        <option value="<?php echo $v1;?>" <?php echo $selected;?>><?php echo $v1;?></option>
                                                    <?php endforeach;?>
                                                </select>
                                                <span>￥<input type='text' name='old_goods_price[<?php echo $v2['id'];?>]' value="<?php echo $v2['attr_price'];?>" style='padding:6px 12px; width:70px;' value='0' /> 元</span>
                                            </div>
                                            </div>
                                        <?php endforeach;?>
                                        <?php else: ?>
                                            <?php if($v['attr_values']): 
                                                  $_attr=explode(',', $v['attr_values']);
                                            ?>
                                                <div class='form-group'><label class='col-sm-2 control-label no-padding-right'><?php echo $v['attr_name'];?></label>
                                            <div class='col-sm-6'>
                                                <select name="old_goods_attr[<?php echo $v['id'];?>]">
                                                    <option value="">请选择</option>
                                                    <?php foreach ($_attr as $k1 => $v1): 
                                                          if($gattrres[$v['id']][0]['attr_value']==$v1){
                                                            $selected='selected="selected"';
                                                          }else{
                                                            $selected='';
                                                          }
                                                    ?>
                                                        <option value="<?php echo $v1;?>" <?php echo $selected;?>><?php echo $v1;?></option>
                                                    <?php endforeach;?>
                                                </select>
                                                <input type='hidden' name='old_goods_price[<?php echo $gattrres[$v['id']][0]['id'];?>]' value='0' />
                                            </div>
                                            </div>
                                            <?php else: ?>
                                                <div class='form-group'><label class='col-sm-2 control-label no-padding-right'><?php echo $v['attr_name'];?></label>
                                            <div class='col-sm-6'>
                                                <input name="old_goods_attr[<?php echo $v['id'];?>]" value="<?php echo $gattrres[$v['id']][0]['attr_value'];?>" type='text' class='form-control' />
                                                <input type='hidden' name='old_goods_price[<?php echo $gattrres[$v['id']][0]['id'];?>]' value='0' />
                                            </div>
                                            </div>
                                            <?php endif;?>
                                        <?php endif;?>
                                        <?php endforeach; endif;?>
                                    </div>
                                </div>

                                <div class="tab-pane" id="profile14">
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label no-padding-right" for="username">
                                            
                                        </label>
                                        <div class="col-sm-6">
                                            <ul style="padding:0;">
                                                <volist name="picres" id="vo">
                                                    <li picid="{$vo.id}" style="list-style:none; float:left;  margin:0 8px;">
                                                    <img height="50" src="__ROOT__{$vo.sm_thumb}"><br />
                                                    <a href="#" onclick="delpic(this);"><i class="fa fa-times sky circular"></i>删</a>
                                                    </li>
                                                </volist>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                            <label class="col-sm-2 control-label no-padding-right" for="username">
                                                <a id="addImg" href="javascript:;">[+]</a>
                                            </label>
                                            <div class="col-sm-6">
                                                <input type="file" name="goods_pics[]">
                                            </div>
                                        </div>
                                </div>
                            </div>
                        </div>
                        <input type="submit" value="修改商品信息" style="width:150px;" class="btn btn-darkorange btn-block">
                        <!-- 111111111111111111111111111111111 -->
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

                </div>
                <!-- /Page Body -->
            </div>
            <!-- /Page Content -->
        </div>  
    </div>

        <!--Basic Scripts-->
    <script src="__PUBLIC__/style/jquery_002.js"></script>
    <script src="__PUBLIC__/style/bootstrap.js"></script>
    <script src="__PUBLIC__/style/jquery.js"></script>
    <!--Beyond Scripts-->
    <script src="__PUBLIC__/style/beyond.js"></script>
    <script type="text/javascript">

    //实例化编辑器
    //建议使用工厂方法getEditor创建和引用编辑器实例，如果在某个闭包下引用该编辑器，直接调用UE.getEditor('editor')就能拿到相关的实例
    UE.getEditor('goods_desc',{initialFrameWidth:1500,initialFrameHeight:500,});
    var str='<div class="form-group"><label class="col-sm-2 control-label no-padding-right" for="username"><a onclick="delImg(this);" href="javascript:;">[-]</a></label><div class="col-sm-6"><input type="file" name="goods_pics[]"></div></div>';
    $("#addImg").click(function(){
        $("#profile14").append(str);
    });

    function delImg(o){
        $(o).parent().parent().remove();
    }

    function attrad(o){
        var div=$(o).parent().parent();
        if($(o).html() == '[+]'){
            var newdiv=div.clone();
            var sel=newdiv.find("select");
            var oldname=sel.attr('name');
            var newname=oldname.replace('old_','');
            sel.attr('name',newname);
            newdiv.find(":text").attr('name','goods_price[]');
            newdiv.find('a').html('[-]');
            div.after(newdiv);
        }else{
            if(confirm('确定要删除该商品属性吗？')){
                var gaid=div.attr('gaid');
                $.ajax({
                type:"GET",
                url:"__CONTROLLER__/ajaxdelga/gaid/"+gaid,
                success:function(data){
                    div.remove();
                }
            });
            }
        }
    }
    //处理删除商品图片
    function delpic(o){
        if(confirm('确定要删除该图片吗？')){
            var li=$(o).parent();
            var picid=li.attr('picid');
            $.ajax({
                type:"GET",
                url:"__CONTROLLER__/ajaxdelpic/picid/"+picid,
                success:function(data){
                    li.remove();
                }
            });
        }
    }
    $("select[name=type_id]").change(function(){

        var typeid=$(this).val();
        $.ajax({
            type:"GET",
            url:"__CONTROLLER__/ajaxgetattr/typeid/"+typeid,
            dataType:"json",
            // success : function(data){

            //     var html="";
            //     $(data).each(function(k,v){
            //         html+="<div class='form-group'><label class='col-sm-2 control-label no-padding-right'>"+v.attr_name+"</label><div class='col-sm-6'><input type='text' class='form-control' /></div></div>";
            //     });
               
            //     $("#attr").html(html);
            // }
            success : function(data){

                var html="";
                $(data).each(function(k,v){
                    // html+="<div class='form-group'><label class='col-sm-2 control-label no-padding-right'>"+v.attr_name+"</label><div class='col-sm-6'><input type='text' class='form-control' /></div></div>";
                    if(v.attr_type == '1'){
                        var attrs=v.attr_values.split(",");
                        html+="<div class='form-group'><label class='col-sm-2 control-label no-padding-right'><a href='javascript:;' onclick='attrad(this);'>[+]</a>"+v.attr_name+"</label><div class='col-sm-6'>";
                        html+="<select name='goods_attr["+v.id+"][]'><option>请选择</option>";
                        for(var i=0; i<attrs.length; i++){
                            html+="<option>"+attrs[i]+"</option>";
                        }
                        html+="</select> <span>￥<input type='text' name='goods_price[]' style='padding:6px 12px; width:70px;' value='0' /> 元</span>";
                        html+="</div></div>";
                    }else{
                        if(v.attr_values != ''){
                            var attrs=v.attr_values.split(",");
                            html+="<div class='form-group'><label class='col-sm-2 control-label no-padding-right'>"+v.attr_name+"</label><div class='col-sm-6'>";
                            html+="<select name='goods_attr["+v.id+"]'><option>请选择</option>";
                            for(var i=0; i<attrs.length; i++){
                                html+="<option>"+attrs[i]+"</option>";
                            }
                            html+="</select><input type='hidden' name='goods_price[]' value='0' />";
                            html+="</div></div>";
                        }else{
                            html+="<div class='form-group'><label class='col-sm-2 control-label no-padding-right'>"+v.attr_name+"</label><div class='col-sm-6'><input name='goods_attr["+v.id+"]' type='text' class='form-control' /><input type='hidden' name='goods_price[]' value='0' /></div></div>";
                        }
                    }
                });
               
                $("#attr").html(html);
            }
        });
    });

</script>


</body></html>